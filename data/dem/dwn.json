{
  "DEM": {
    ".": "dwn",
    "cust": {
      "reg": {
        ".": {
          "desc": "Registry to save customer data is not related to downline tree directly.",
          "attr": {
            "customer_ref": {
              "type": "reference",
              "desc": "Reference to the customer data in main DB structure."
            },
            "mlm_id": {
              "type": "string",
              "desc": "MLM ID of the customer."
            },
            "is_deleted": {
              "type": "boolean",
              "desc": "'true' if customer is deleted/anonymized."
            },
            "is_inactive": {
              "type": "boolean",
              "desc": "'true' if customer is inactive."
            }
          },
          "index": {
            "pk": {
              "type": "primary",
              "attrs": ["customer_ref"]
            },
            "uniqueMlmId": {
              "type": "unique",
              "attrs": ["mlm_id"]
            }
          },
          "relation": {
            "member": {
              ".comment": "TODO: should we have a foreign key in case of customer can be deleted in the primary customer table?",
              "path": "/res/partner",
              "own": ["customer_ref"],
              "foreign": ["id"],
              "on": {"delete": "restrict", "update": "cascade"}
            }
          }
        }
      }
    },
    "tree": {
      ".": {
        "desc": "Natural tree to save current 'parent-child' relations between members.",
        "attr": {
          "member_ref": {
            "type": "reference",
            "desc": "Reference to the member itself."
          },
          "parent_ref": {
            "type": "reference",
            "desc": "Reference to the member's parent."
          },
          "depth": {
            "type": "integer",
            "desc": "Depth of the member placement in the tree (starting from 1)."
          },
          "path": {
            "type": "string",
            "desc": "Path to the current member (all parents IDs - ':1:23:345:')."
          }
        },
        "index": {
          "pk": {
            "type": "primary",
            "attrs": ["member_ref"]
          }
        },
        "relation": {
          "member": {
            "path": "/dwn/cust/reg",
            "own": ["member_ref"],
            "foreign": ["customer_ref"],
            "on": {"delete": "restrict", "update": "cascade"}
          },
          "parent": {
            "path": "/dwn/tree",
            "own": ["parent_ref"],
            "foreign": ["member_ref"],
            "on": {"delete": "restrict", "update": "cascade"}
          }
        }
      },
      "trace": {
        ".": {
          "desc": "Trace log to save changes in 'parent-child' relations between members.",
          "attr": {
            "id": {
              "type": "identity",
              "desc": "ID of the trace log item to add natural order if 'date' values are equal for different items."
            },
            "member_ref": {
              "type": "reference",
              "desc": "Reference to the member itself."
            },
            "parent_ref": {
              "type": "reference",
              "desc": "Reference to the member's  parent.",
              "nullable": true
            },
            "date": {
              "type": "datetime",
              "desc": "Reference to the parent."
            }
          },
          "relation": {
            "member": {
              "path": "/dwn/cust/reg",
              "own": ["member_ref"],
              "foreign": ["customer_ref"],
              "on": {"delete": "cascade", "update": "cascade"}
            },
            "parent": {
              "path": "/dwn/cust/reg",
              "own": ["parent_ref"],
              "foreign": ["customer_ref"],
              "on": {"delete": "cascade", "update": "cascade"}
            }
          }
        }
      }
    }
  }
}